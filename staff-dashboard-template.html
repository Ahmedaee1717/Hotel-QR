<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Check-in Dashboard - RESTAURANT_NAME</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Table status colors */
        .table-free { background-color: #10B981; border-color: #059669; }
        .table-booked { background-color: #F59E0B; border-color: #D97706; }
        .table-occupied { background-color: #EF4444; border-color: #DC2626; }
        
        /* Table shapes */
        .table-element {
            position: absolute;
            border: 3px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .table-element:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 10;
        }
        .table-rectangle { border-radius: 8px; }
        .table-circle { border-radius: 50%; }
        .table-square { border-radius: 8px; }
        
        #floorCanvas {
            position: relative;
            background: #F9FAFB;
            background-image: 
                linear-gradient(rgba(0, 0, 0, .05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, .05) 1px, transparent 1px);
            background-size: 50px 50px;
            border: 2px solid #E5E7EB;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
        }
        
        /* Pulse animation for new reservations */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); }
            50% { box-shadow: 0 0 0 15px rgba(245, 158, 11, 0); }
        }
        .new-reservation {
            animation: pulse-glow 2s infinite;
        }
        
        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 50;
            backdrop-filter: blur(4px);
        }
        .modal-overlay.show { display: flex; }
        
        /* Search highlight */
        .search-highlight {
            background-color: #FEF3C7;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div class="bg-gradient-to-r from-green-700 to-emerald-700 text-white py-3 px-4 shadow-lg">
        <div class="max-w-full mx-auto">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <i class="fas fa-door-open text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">Staff Check-in Dashboard</h1>
                        <p class="text-sm opacity-90" id="restaurantName">Loading...</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Current Time -->
                    <div class="text-right">
                        <div class="text-2xl font-bold font-mono" id="currentTime">00:00</div>
                        <div class="text-xs opacity-75" id="currentDate">Loading...</div>
                    </div>
                    <!-- Stats Summary -->
                    <div class="bg-white/20 rounded-lg px-4 py-2">
                        <div class="text-xs opacity-75">Tables</div>
                        <div class="text-xl font-bold">
                            <span id="freeTablesCount">0</span>/<span id="totalTablesCount">0</span> Free
                        </div>
                    </div>
                    <button onclick="refreshAll()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-full mx-auto p-4 grid grid-cols-3 gap-4" style="height: calc(100vh - 80px);">
        <!-- LEFT: Live Floor Map (50% width) -->
        <div class="col-span-2 bg-white rounded-lg shadow-lg p-4 overflow-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold flex items-center gap-2">
                    <i class="fas fa-map text-green-600"></i>
                    Live Floor Plan
                </h2>
                <div class="flex items-center gap-2">
                    <!-- Legend -->
                    <div class="flex items-center gap-3 text-sm">
                        <div class="flex items-center gap-1">
                            <div class="w-4 h-4 rounded bg-green-500"></div>
                            <span>Free (<span id="legendFree">0</span>)</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <div class="w-4 h-4 rounded bg-yellow-500"></div>
                            <span>Booked (<span id="legendBooked">0</span>)</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <div class="w-4 h-4 rounded bg-red-500"></div>
                            <span>Occupied (<span id="legendOccupied">0</span>)</span>
                        </div>
                    </div>
                    <!-- Zoom Controls -->
                    <button onclick="zoomIn()" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <button onclick="zoomOut()" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <button onclick="resetZoom()" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm">
                        Reset
                    </button>
                </div>
            </div>
            
            <!-- Floor Canvas Container -->
            <div style="width: 100%; height: calc(100% - 60px); overflow: auto;" id="canvasContainer">
                <div id="floorCanvas" style="width: 1000px; height: 600px; transform-origin: top left;">
                    <!-- Tables will be rendered here -->
                </div>
            </div>
        </div>

        <!-- RIGHT: Actions & Information (50% width) -->
        <div class="flex flex-col gap-4 overflow-auto">
            <!-- Quick Actions -->
            <div class="bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg shadow-lg p-4">
                <h3 class="text-lg font-bold mb-3">
                    <i class="fas fa-bolt mr-2"></i>Quick Actions
                </h3>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="showWalkInModal()" class="bg-white/20 hover:bg-white/30 rounded-lg p-3 transition font-semibold">
                        <i class="fas fa-walking mr-2"></i>Walk-in Guest
                    </button>
                    <button onclick="showSearchModal()" class="bg-white/20 hover:bg-white/30 rounded-lg p-3 transition font-semibold">
                        <i class="fas fa-search mr-2"></i>Find Reservation
                    </button>
                    <button onclick="showAllReservations()" class="bg-white/20 hover:bg-white/30 rounded-lg p-3 transition font-semibold">
                        <i class="fas fa-calendar-check mr-2"></i>Today's Bookings
                    </button>
                    <button onclick="showWaitlist()" class="bg-white/20 hover:bg-white/30 rounded-lg p-3 transition font-semibold">
                        <i class="fas fa-clock mr-2"></i>Waitlist
                    </button>
                </div>
            </div>

            <!-- Pending Check-ins (Guests who booked and arrived) -->
            <div class="bg-white rounded-lg shadow-lg p-4 flex-1">
                <h3 class="text-lg font-bold mb-3 flex items-center justify-between">
                    <span>
                        <i class="fas fa-user-clock text-orange-600 mr-2"></i>
                        Pending Check-ins
                    </span>
                    <span class="text-sm bg-orange-100 text-orange-800 px-2 py-1 rounded-full" id="pendingCount">0</span>
                </h3>
                <div id="pendingCheckIns" class="space-y-2 max-h-96 overflow-auto">
                    <!-- Pending reservations will appear here -->
                </div>
            </div>

            <!-- Current Sessions (Checked-in guests) -->
            <div class="bg-white rounded-lg shadow-lg p-4 flex-1">
                <h3 class="text-lg font-bold mb-3 flex items-center justify-between">
                    <span>
                        <i class="fas fa-user-check text-green-600 mr-2"></i>
                        Currently Dining
                    </span>
                    <span class="text-sm bg-green-100 text-green-800 px-2 py-1 rounded-full" id="activeCount">0</span>
                </h3>
                <div id="activeSessions" class="space-y-2 max-h-96 overflow-auto">
                    <!-- Active sessions will appear here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Table Details & Check-in -->
    <div id="tableModal" class="modal-overlay items-center justify-center">
        <div class="bg-white rounded-lg shadow-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-auto">
            <div class="bg-gradient-to-r from-green-600 to-emerald-600 text-white p-4 rounded-t-lg">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">
                        <i class="fas fa-chair mr-2"></i>
                        Table <span id="modalTableNumber"></span>
                    </h3>
                    <button onclick="closeTableModal()" class="text-white hover:bg-white/20 rounded p-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div id="modalTableContent">
                    <!-- Content will be populated dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Walk-in Guest -->
    <div id="walkInModal" class="modal-overlay items-center justify-center">
        <div class="bg-white rounded-lg shadow-2xl max-w-lg w-full mx-4">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-4 rounded-t-lg">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">
                        <i class="fas fa-walking mr-2"></i>Check-in Walk-in Guest
                    </h3>
                    <button onclick="closeWalkInModal()" class="text-white hover:bg-white/20 rounded p-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <form id="walkInForm" onsubmit="submitWalkIn(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold mb-1">Guest Name *</label>
                            <input type="text" id="walkInName" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Number of Guests *</label>
                            <input type="number" id="walkInGuests" required min="1" value="2" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Phone (Optional)</label>
                            <input type="tel" id="walkInPhone" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Select Table *</label>
                            <select id="walkInTable" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">-- Choose Available Table --</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Notes</label>
                            <textarea id="walkInNotes" rows="2" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                    </div>
                    <div class="mt-6 flex gap-3">
                        <button type="button" onclick="closeWalkInModal()" class="flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">
                            Cancel
                        </button>
                        <button type="submit" class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold">
                            <i class="fas fa-check mr-2"></i>Check In
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Search Reservation -->
    <div id="searchModal" class="modal-overlay items-center justify-center">
        <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto">
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 rounded-t-lg">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">
                        <i class="fas fa-search mr-2"></i>Find Reservation
                    </h3>
                    <button onclick="closeSearchModal()" class="text-white hover:bg-white/20 rounded p-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <input type="text" id="searchInput" placeholder="Search by name, phone, or booking ID..." 
                       oninput="searchReservations(this.value)"
                       class="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-purple-500 text-lg mb-4">
                <div id="searchResults" class="space-y-2">
                    <!-- Search results will appear here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const OFFERING_ID = 'OFFERING_ID_PLACEHOLDER';
        let floorElements = [];
        let currentSessions = [];
        let currentReservations = [];
        let currentScale = 1;

        // Initialize
        async function init() {
            await loadRestaurantInfo();
            await loadFloorPlan();
            await loadPendingCheckIns();
            await loadActiveSessions();
            
            // Update time every second
            updateTime();
            setInterval(updateTime, 1000);
            
            // Auto-refresh every 30 seconds
            setInterval(refreshAll, 30000);
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        async function loadRestaurantInfo() {
            const response = await fetch('/api/offerings/' + OFFERING_ID);
            const data = await response.json();
            if (data.success && data.offering) {
                document.getElementById('restaurantName').textContent = data.offering.title;
            }
        }

        async function loadFloorPlan() {
            // Load floor elements
            const response = await fetch('/api/admin/restaurant/' + OFFERING_ID + '/floor-elements');
            const data = await response.json();
            
            if (data.success) {
                floorElements = data.elements || [];
                renderFloorPlan();
                updateTableStats();
            }
        }

        function renderFloorPlan() {
            const canvas = document.getElementById('floorCanvas');
            canvas.innerHTML = '';
            
            // Filter tables only
            const tables = floorElements.filter(el => el.element_type === 'table');
            
            tables.forEach(table => {
                const tableEl = document.createElement('div');
                tableEl.className = 'table-element table-' + (table.shape || 'rectangle');
                tableEl.id = 'table-' + table.element_id;
                tableEl.style.left = table.x + 'px';
                tableEl.style.top = table.y + 'px';
                tableEl.style.width = table.width + 'px';
                tableEl.style.height = table.height + 'px';
                
                // Determine status
                const status = getTableStatus(table.table_number);
                tableEl.classList.add('table-' + status);
                
                // Content
                tableEl.innerHTML = '<div class="text-center">' +
                    '<div class="text-lg font-bold">' + table.table_number + '</div>' +
                    '<div class="text-xs">' + table.capacity + ' seats</div>' +
                    '</div>';
                
                // Click handler
                tableEl.onclick = () => openTableModal(table);
                
                canvas.appendChild(tableEl);
            });
        }

        function getTableStatus(tableNumber) {
            // Check if table has an active session
            const session = currentSessions.find(s => s.table_number === tableNumber);
            if (session) return 'occupied';
            
            // Check if table has a pending reservation
            const reservation = currentReservations.find(r => r.table_number === tableNumber && r.status === 'confirmed');
            if (reservation) return 'booked';
            
            return 'free';
        }

        function updateTableStats() {
            const tables = floorElements.filter(el => el.element_type === 'table');
            const free = tables.filter(t => getTableStatus(t.table_number) === 'free').length;
            const booked = tables.filter(t => getTableStatus(t.table_number) === 'booked').length;
            const occupied = tables.filter(t => getTableStatus(t.table_number) === 'occupied').length;
            
            document.getElementById('freeTablesCount').textContent = free;
            document.getElementById('totalTablesCount').textContent = tables.length;
            document.getElementById('legendFree').textContent = free;
            document.getElementById('legendBooked').textContent = booked;
            document.getElementById('legendOccupied').textContent = occupied;
        }

        async function loadPendingCheckIns() {
            const today = new Date().toISOString().split('T')[0];
            const response = await fetch('/api/admin/restaurant/reservations?offering_id=' + OFFERING_ID + '&start_date=' + today + '&end_date=' + today);
            const data = await response.json();
            
            if (data.success) {
                currentReservations = data.reservations || [];
                const pending = currentReservations.filter(r => r.status === 'confirmed');
                
                document.getElementById('pendingCount').textContent = pending.length;
                
                const container = document.getElementById('pendingCheckIns');
                if (pending.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">No pending check-ins</p>';
                } else {
                    container.innerHTML = pending.map(r => `
                        <div class="border-2 border-orange-200 bg-orange-50 rounded-lg p-3 hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <div class="font-bold text-lg">${r.guest_name}</div>
                                    <div class="text-sm text-gray-600">
                                        <i class="fas fa-users mr-1"></i>${r.number_of_guests} guests
                                        <span class="mx-2">‚Ä¢</span>
                                        <i class="fas fa-clock mr-1"></i>${r.reservation_time}
                                    </div>
                                    ${r.phone_number ? '<div class="text-sm text-gray-600"><i class="fas fa-phone mr-1"></i>' + r.phone_number + '</div>' : ''}
                                </div>
                                <button onclick="checkInReservation(${r.reservation_id})" 
                                        class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold text-sm">
                                    Check In
                                </button>
                            </div>
                            ${r.table_number ? '<div class="text-sm bg-white px-2 py-1 rounded inline-block"><i class="fas fa-chair mr-1"></i>Table ' + r.table_number + '</div>' : ''}
                        </div>
                    `).join('');
                }
            }
        }

        async function loadActiveSessions() {
            const response = await fetch('/api/admin/restaurant/sessions?offering_id=' + OFFERING_ID);
            const data = await response.json();
            
            if (data.success) {
                currentSessions = data.sessions || [];
                const active = currentSessions.filter(s => s.status === 'active');
                
                document.getElementById('activeCount').textContent = active.length;
                
                const container = document.getElementById('activeSessions');
                if (active.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">No active sessions</p>';
                } else {
                    container.innerHTML = active.map(s => `
                        <div class="border-2 border-green-200 bg-green-50 rounded-lg p-3">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="font-bold">${s.guest_name || 'Walk-in'}</div>
                                    <div class="text-sm text-gray-600">
                                        <i class="fas fa-chair mr-1"></i>Table ${s.table_number}
                                        <span class="mx-2">‚Ä¢</span>
                                        <i class="fas fa-users mr-1"></i>${s.number_of_guests} guests
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        <i class="fas fa-clock mr-1"></i>Checked in: ${new Date(s.start_time).toLocaleTimeString()}
                                    </div>
                                </div>
                                <button onclick="checkOutSession(${s.session_id})" 
                                        class="px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded text-sm font-semibold">
                                    Check Out
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        async function refreshAll() {
            await Promise.all([
                loadFloorPlan(),
                loadPendingCheckIns(),
                loadActiveSessions()
            ]);
        }

        // Table Modal
        function openTableModal(table) {
            const status = getTableStatus(table.table_number);
            document.getElementById('modalTableNumber').textContent = table.table_number;
            
            let content = '';
            if (status === 'free') {
                content = `
                    <div class="text-center mb-4">
                        <div class="text-6xl mb-2">‚úÖ</div>
                        <div class="text-xl font-bold text-green-600">Table Available</div>
                        <div class="text-gray-600 mt-2">Capacity: ${table.capacity} guests</div>
                    </div>
                    <button onclick="quickCheckIn('${table.table_number}')" 
                            class="w-full px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold text-lg">
                        <i class="fas fa-user-plus mr-2"></i>Quick Check-in
                    </button>
                `;
            } else if (status === 'booked') {
                const reservation = currentReservations.find(r => r.table_number === table.table_number);
                content = `
                    <div class="text-center mb-4">
                        <div class="text-6xl mb-2">üìÖ</div>
                        <div class="text-xl font-bold text-orange-600">Reserved</div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <div class="font-bold text-lg">${reservation.guest_name}</div>
                        <div class="text-sm text-gray-600 mt-2">
                            <i class="fas fa-clock mr-1"></i>${reservation.reservation_time}
                            <span class="mx-2">‚Ä¢</span>
                            <i class="fas fa-users mr-1"></i>${reservation.number_of_guests} guests
                        </div>
                        ${reservation.phone_number ? '<div class="text-sm text-gray-600 mt-1"><i class="fas fa-phone mr-1"></i>' + reservation.phone_number + '</div>' : ''}
                    </div>
                    <button onclick="checkInReservation(${reservation.reservation_id})" 
                            class="w-full px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold text-lg">
                        <i class="fas fa-check mr-2"></i>Check In Guest
                    </button>
                `;
            } else {
                const session = currentSessions.find(s => s.table_number === table.table_number);
                content = `
                    <div class="text-center mb-4">
                        <div class="text-6xl mb-2">üçΩÔ∏è</div>
                        <div class="text-xl font-bold text-red-600">Currently Occupied</div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <div class="font-bold text-lg">${session.guest_name || 'Walk-in Guest'}</div>
                        <div class="text-sm text-gray-600 mt-2">
                            <i class="fas fa-users mr-1"></i>${session.number_of_guests} guests
                        </div>
                        <div class="text-sm text-gray-600 mt-1">
                            <i class="fas fa-clock mr-1"></i>Since ${new Date(session.start_time).toLocaleTimeString()}
                        </div>
                    </div>
                    <button onclick="checkOutSession(${session.session_id})" 
                            class="w-full px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold text-lg">
                        <i class="fas fa-door-open mr-2"></i>Check Out
                    </button>
                `;
            }
            
            document.getElementById('modalTableContent').innerHTML = content;
            document.getElementById('tableModal').classList.add('show');
        }

        function closeTableModal() {
            document.getElementById('tableModal').classList.remove('show');
        }

        function quickCheckIn(tableNumber) {
            closeTableModal();
            showWalkInModal();
            document.getElementById('walkInTable').value = tableNumber;
        }

        // Walk-in Modal
        function showWalkInModal() {
            // Populate available tables
            const tables = floorElements.filter(el => el.element_type === 'table');
            const freeTables = tables.filter(t => getTableStatus(t.table_number) === 'free');
            
            const select = document.getElementById('walkInTable');
            select.innerHTML = '<option value="">-- Choose Available Table --</option>' +
                freeTables.map(t => `<option value="${t.table_number}">Table ${t.table_number} (${t.capacity} seats)</option>`).join('');
            
            document.getElementById('walkInModal').classList.add('show');
        }

        function closeWalkInModal() {
            document.getElementById('walkInModal').classList.remove('show');
            document.getElementById('walkInForm').reset();
        }

        async function submitWalkIn(event) {
            event.preventDefault();
            
            const data = {
                offering_id: OFFERING_ID,
                guest_name: document.getElementById('walkInName').value,
                number_of_guests: parseInt(document.getElementById('walkInGuests').value),
                phone_number: document.getElementById('walkInPhone').value,
                table_number: document.getElementById('walkInTable').value,
                special_requests: document.getElementById('walkInNotes').value,
                source: 'walk-in'
            };
            
            const response = await fetch('/api/admin/restaurant/sessions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            if (result.success) {
                alert('‚úÖ Guest checked in successfully!');
                closeWalkInModal();
                refreshAll();
            } else {
                alert('‚ùå Error: ' + (result.error || 'Failed to check in'));
            }
        }

        // Check-in reservation
        async function checkInReservation(reservationId) {
            if (!confirm('Check in this guest?')) return;
            
            const response = await fetch('/api/admin/restaurant/reservations/' + reservationId + '/check-in', {
                method: 'POST'
            });
            
            const result = await response.json();
            if (result.success) {
                alert('‚úÖ Guest checked in!');
                closeTableModal();
                refreshAll();
            } else {
                alert('‚ùå Error: ' + (result.error || 'Failed to check in'));
            }
        }

        // Check-out session
        async function checkOutSession(sessionId) {
            if (!confirm('Check out this guest?')) return;
            
            const response = await fetch('/api/admin/restaurant/sessions/' + sessionId + '/end', {
                method: 'POST'
            });
            
            const result = await response.json();
            if (result.success) {
                alert('‚úÖ Guest checked out!');
                closeTableModal();
                refreshAll();
            } else {
                alert('‚ùå Error: ' + (result.error || 'Failed to check out'));
            }
        }

        // Search Modal
        function showSearchModal() {
            document.getElementById('searchModal').classList.add('show');
            document.getElementById('searchInput').focus();
        }

        function closeSearchModal() {
            document.getElementById('searchModal').classList.remove('show');
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').innerHTML = '';
        }

        function searchReservations(query) {
            if (!query || query.length < 2) {
                document.getElementById('searchResults').innerHTML = '<p class="text-gray-500 text-center py-4">Type to search...</p>';
                return;
            }
            
            const results = currentReservations.filter(r => 
                r.guest_name.toLowerCase().includes(query.toLowerCase()) ||
                (r.phone_number && r.phone_number.includes(query)) ||
                r.reservation_id.toString() === query
            );
            
            if (results.length === 0) {
                document.getElementById('searchResults').innerHTML = '<p class="text-gray-500 text-center py-4">No results found</p>';
            } else {
                document.getElementById('searchResults').innerHTML = results.map(r => `
                    <div class="border rounded-lg p-4 hover:bg-gray-50">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="font-bold text-lg">${r.guest_name}</div>
                                <div class="text-sm text-gray-600 mt-1">
                                    <i class="fas fa-calendar mr-1"></i>${r.reservation_date}
                                    <span class="mx-2">‚Ä¢</span>
                                    <i class="fas fa-clock mr-1"></i>${r.reservation_time}
                                </div>
                                <div class="text-sm text-gray-600">
                                    <i class="fas fa-users mr-1"></i>${r.number_of_guests} guests
                                    ${r.table_number ? '<span class="mx-2">‚Ä¢</span><i class="fas fa-chair mr-1"></i>Table ' + r.table_number : ''}
                                </div>
                                ${r.phone_number ? '<div class="text-sm text-gray-600"><i class="fas fa-phone mr-1"></i>' + r.phone_number + '</div>' : ''}
                            </div>
                            <div>
                                <span class="px-2 py-1 rounded text-xs font-semibold ${r.status === 'confirmed' ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800'}">
                                    ${r.status}
                                </span>
                                ${r.status === 'confirmed' ? `
                                    <button onclick="checkInReservation(${r.reservation_id}); closeSearchModal();" 
                                            class="mt-2 px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm font-semibold">
                                        Check In
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function showAllReservations() {
            showSearchModal();
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').innerHTML = currentReservations.map(r => `
                <div class="border rounded-lg p-4 hover:bg-gray-50">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-bold text-lg">${r.guest_name}</div>
                            <div class="text-sm text-gray-600 mt-1">
                                <i class="fas fa-calendar mr-1"></i>${r.reservation_date}
                                <span class="mx-2">‚Ä¢</span>
                                <i class="fas fa-clock mr-1"></i>${r.reservation_time}
                            </div>
                            <div class="text-sm text-gray-600">
                                <i class="fas fa-users mr-1"></i>${r.number_of_guests} guests
                                ${r.table_number ? '<span class="mx-2">‚Ä¢</span><i class="fas fa-chair mr-1"></i>Table ' + r.table_number : ''}
                            </div>
                        </div>
                        <div>
                            <span class="px-2 py-1 rounded text-xs font-semibold ${r.status === 'confirmed' ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800'}">
                                ${r.status}
                            </span>
                            ${r.status === 'confirmed' ? `
                                <button onclick="checkInReservation(${r.reservation_id}); closeSearchModal();" 
                                        class="mt-2 px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm font-semibold">
                                    Check In
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showWaitlist() {
            alert('Waitlist feature coming soon!');
        }

        // Zoom controls
        function zoomIn() {
            currentScale = Math.min(currentScale + 0.2, 2);
            document.getElementById('floorCanvas').style.transform = 'scale(' + currentScale + ')';
        }

        function zoomOut() {
            currentScale = Math.max(currentScale - 0.2, 0.5);
            document.getElementById('floorCanvas').style.transform = 'scale(' + currentScale + ')';
        }

        function resetZoom() {
            currentScale = 1;
            document.getElementById('floorCanvas').style.transform = 'scale(1)';
        }

        // Initialize on page load
        window.onload = init;
    </script>
</body>
</html>
